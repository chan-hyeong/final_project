<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kosta.finalproject.customer.dao.InventoryDAO">

	<!-- 주문이 들어온 경우 (결제가 완료된 경우) or 주문이 취소된 경우 (결제 취소) 재고를 수정해야함  -->
	<update id="update_inventory_by_order">
		update inventory
		set 
			i_amount = i_amount - #{param1}
		where 
			i_code = #{param2}
	</update>
	<update id="test_update_inventory_by_order" parameterType="hashmap">
		update inventory
		set 
			i_amount = i_amount - #{val}
		where 
			${field} = #{i_code}
	</update>
	
	<select id="test1" resultType="kosta.finalproject.customer.dto.TestDTO">
		select *
				 from ( select i.i_code
							, i.i_amount
	               			, (		select sum( decode(i.i_code , 
				                                        m_necessary1, m_necessary1_num, 
				                                        m_necessary2, m_necessary2_num, 
				                                        m_necessary3, m_necessary3_num, 
				                                        m_necessary4, m_necessary4_num, 
				                                        o_option1, o_option1_num, 
				                                        o_option2, o_option2_num, 
				                                        o_option3, o_option3_num, 
				                                        o_option4, o_option4_num, 
				                                        o_option5, o_option5_num, 
				                                        o_vege1, 1, o_vege2, 1, 
				                                        o_vege3, 1, o_vege4, 1, 
				                                        o_vege5, 1, o_vege6, 1, 
				                                        o_vege7, 1, o_vege8, 1, 0))
	                    			from order_detail
	                    			where order_num = #{param1} 
              					) as changed_i_amount 
        				 from inventory i
     					 where i.s_code = #{param2})  
     	where changed_i_amount > 0 
	</select>
	
	<update id="wow_update_inventory_by_order" >
		update ( select * 
				 from ( select i.i_code
							, i.i_amount
	               			, (		select sum( decode(i.i_code , 
	               										o_pan, 1,
				                                        m_necessary1, m_necessary1_num, 
				                                        m_necessary2, m_necessary2_num, 
				                                        m_necessary3, m_necessary3_num, 
				                                        m_necessary4, m_necessary4_num, 
				                                        o_option1, o_option1_num, 
				                                        o_option2, o_option2_num, 
				                                        o_option3, o_option3_num, 
				                                        o_option4, o_option4_num, 
				                                        o_option5, o_option5_num, 
				                                        o_vege1, 1, o_vege2, 1, 
				                                        o_vege3, 1, o_vege4, 1, 
				                                        o_vege5, 1, o_vege6, 1, 
				                                        o_vege7, 1, o_vege8, 1, 0))
	                    			from order_detail
	                    			where order_num = #{param1} 
              					) as changed_i_amount 
        				 from inventory i
     					 where i.s_code = #{param2}) 
     			 where changed_i_amount > 0) 
		set i_amount =  i_amount - changed_i_amount
	</update>
	
<!-- 	
	<update id="wow_update_inventory_by_order" parameterType="kosta.finalproject.customer.dto.Order_ListTDTO">
		update ( select * 
				 from ( select i.i_code
							, i.i_amount
	               			, (		select sum( decode(i.i_code , 
	               										o_pan, 1,
				                                        m_necessary1, m_necessary1_num, 
				                                        m_necessary2, m_necessary2_num, 
				                                        m_necessary3, m_necessary3_num, 
				                                        m_necessary4, m_necessary4_num, 
				                                        o_option1, o_option1_num, 
				                                        o_option2, o_option2_num, 
				                                        o_option3, o_option3_num, 
				                                        o_option4, o_option4_num, 
				                                        o_option5, o_option5_num, 
				                                        o_vege1, 1, o_vege2, 1, 
				                                        o_vege3, 1, o_vege4, 1, 
				                                        o_vege5, 1, o_vege6, 1, 
				                                        o_vege7, 1, o_vege8, 1, 0))
	                    			from order_detail
	                    			where order_num = #{order_num} 
              					) as changed_i_amount 
        				 from inventory i
     					 where i.s_code = #{s_code}) 
     			 where changed_i_amount > 0) 
		set i_amount =  i_amount - changed_i_amount
	</update>
	 -->
	
	<!-- 소비자가 메뉴 선택시 재료의 재고가 없는 메뉴는 선택불가하게, 또는 결제불가하게 만들어야함 체크 인벤토리 --> 
	<select id="select_invetory_check_for_customer">
	
	</select>


</mapper>